<!DOCTYPE html>
<html lang="es">

    <head>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <title>Performance - Trading Journal</title>
        <style>
            * {
                margin: 0;
                padding: 0;
                box-sizing: border-box;
            }

            body {
                font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
                background-color: #0d1421;
                color: #d1d4dc;
                line-height: 1.5;
            }

            .container {
                max-width: 1400px;
                margin: 0 auto;
                padding: 20px;
            }

            .header {
                margin-bottom: 30px;
            }

            .header h1 {
                font-size: 28px;
                font-weight: 600;
                color: #ffffff;
                margin-bottom: 8px;
            }

            .header .subtitle {
                color: #868b94;
                font-size: 14px;
            }

            /* Filters */
            .filters {
                background: #131722;
                border: 1px solid #2a2e39;
                border-radius: 8px;
                padding: 20px;
                margin-bottom: 30px;
            }

            .filters h3 {
                color: #ffffff;
                margin-bottom: 15px;
                font-size: 16px;
                font-weight: 600;
            }

            .filter-row {
                display: grid;
                grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
                gap: 15px;
            }

            .filter-group {
                display: flex;
                flex-direction: column;
            }

            .filter-group label {
                color: #868b94;
                font-size: 12px;
                font-weight: 500;
                margin-bottom: 5px;
                text-transform: uppercase;
                letter-spacing: 0.5px;
            }

            .filter-group select,
            .filter-group input {
                background: #1e222d;
                border: 1px solid #2a2e39;
                border-radius: 4px;
                color: #d1d4dc;
                padding: 8px 12px;
                font-size: 14px;
                transition: all 0.2s;
            }

            .filter-group select:focus,
            .filter-group input:focus {
                outline: none;
                border-color: #2962ff;
                box-shadow: 0 0 0 2px rgba(41, 98, 255, 0.1);
            }

            .filter-actions {
                grid-column: 1 / -1;
                display: flex;
                gap: 10px;
                margin-top: 15px;
            }

            .btn {
                padding: 8px 16px;
                border: none;
                border-radius: 4px;
                font-size: 14px;
                font-weight: 500;
                cursor: pointer;
                transition: all 0.2s;
            }

            .btn-primary {
                background: #2962ff;
                color: white;
            }

            .btn-primary:hover {
                background: #1e53e5;
            }

            .btn-secondary {
                background: #2a2e39;
                color: #d1d4dc;
                border: 1px solid #434651;
            }

            .btn-secondary:hover {
                background: #363a45;
            }

            /* Tab Navigation */
            .tab-nav {
                display: flex;
                gap: 2px;
                margin-bottom: 30px;
                border-bottom: 1px solid #2a2e39;
            }

            .tab-btn {
                background: transparent;
                border: none;
                padding: 12px 20px;
                color: #868b94;
                font-size: 14px;
                font-weight: 500;
                cursor: pointer;
                border-bottom: 2px solid transparent;
                transition: all 0.2s;
            }

            .tab-btn.active {
                color: #2962ff;
                border-bottom-color: #2962ff;
            }

            .tab-btn:hover {
                color: #d1d4dc;
            }

            /* Stats Grid */
            .stats-grid {
                display: grid;
                grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
                gap: 20px;
                margin-bottom: 30px;
            }

            .stats-card {
                background: #131722;
                border: 1px solid #2a2e39;
                border-radius: 8px;
                padding: 20px;
            }

            .stats-card h3 {
                color: #ffffff;
                font-size: 16px;
                font-weight: 600;
                margin-bottom: 15px;
                display: flex;
                align-items: center;
                gap: 8px;
            }

            .stats-card h3::before {
                content: '';
                width: 3px;
                height: 16px;
                background: #2962ff;
                border-radius: 2px;
            }

            .stat-row {
                display: flex;
                justify-content: space-between;
                align-items: center;
                padding: 8px 0;
                border-bottom: 1px solid #1e222d;
            }

            .stat-row:last-child {
                border-bottom: none;
            }

            .stat-label {
                color: #868b94;
                font-size: 13px;
                font-weight: 500;
            }

            .stat-value {
                font-size: 14px;
                font-weight: 600;
                color: #d1d4dc;
            }

            .stat-value.positive {
                color: #00c851;
            }

            .stat-value.negative {
                color: #ff4444;
            }

            .stat-value.neutral {
                color: #ffbb33;
            }

            /* Summary Cards */
            .summary-cards {
                display: grid;
                grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
                gap: 15px;
                margin-bottom: 30px;
            }

            .summary-card {
                background: #131722;
                border: 1px solid #2a2e39;
                border-radius: 8px;
                padding: 20px;
                text-align: center;
            }

            .summary-card .value {
                font-size: 24px;
                font-weight: 700;
                margin-bottom: 5px;
            }

            .summary-card .label {
                color: #868b94;
                font-size: 12px;
                font-weight: 500;
                text-transform: uppercase;
                letter-spacing: 0.5px;
            }

            /* Tab Content */
            .tab-content {
                display: none;
            }

            .tab-content.active {
                display: block;
            }

            /* Responsive */
            @media (max-width: 768px) {
                .container {
                    padding: 15px;
                }

                .filter-row {
                    grid-template-columns: 1fr;
                }

                .stats-grid {
                    grid-template-columns: 1fr;
                }

                .summary-cards {
                    grid-template-columns: repeat(2, 1fr);
                }

                .tab-nav {
                    overflow-x: auto;
                    -webkit-overflow-scrolling: touch;
                }
            }
        </style>
    </head>

    <body>
        <div class="container">
            <!-- Header -->
            <div class="header">
                <h1>Performance Analysis</h1>
                <p class="subtitle">Comprehensive trading performance metrics and analysis</p>
            </div>

            <!-- Filters -->
            <div class="filters">
                <div class="filter-row">
                    <div class="filter-group">
                        <label>Start Date</label>
                        <input type="date" id="start-date">
                    </div>
                    <div class="filter-group">
                        <label>End Date</label>
                        <input type="date" id="end-date">
                    </div>
                    <div class="filter-group">
                        <label>Strategy</label>
                        <select id="strategy">
                            <option value="">All Strategies</option>
                            <option value="1">Scalping</option>
                            <option value="2">Swing Trading</option>
                            <option value="3">Mean Reversion</option>
                        </select>
                    </div>
                    <div class="filter-group">
                        <label>Symbol</label>
                        <input type="text" id="symbol" placeholder="e.g., AAPL">
                    </div>
                    <div class="filter-group">
                        <label>Side</label>
                        <select id="side">
                            <option value="">Both</option>
                            <option value="LONG">Long</option>
                            <option value="SHORT">Short</option>
                        </select>
                    </div>
                    <div class="filter-group">
                        <label>Limit</label>
                        <select id="limit">
                            <option value="">All Trades</option>
                            <option value="100">Last 100</option>
                            <option value="500">Last 500</option>
                            <option value="1000">Last 1000</option>
                        </select>
                    </div>
                </div>
                <div class="filter-actions">
                    <button class="btn btn-primary" onclick="applyFilters()">Apply Filters</button>
                    <button class="btn btn-secondary" onclick="resetFilters()">Reset</button>
                </div>
            </div>

            <!-- Tab Navigation -->
            <div class="tab-nav">
                <button class="tab-btn active" onclick="showTab('gross')">Gross Performance</button>
                <button class="tab-btn" onclick="showTab('net')">Net Performance</button>
                <button class="tab-btn" onclick="showTab('general')">General Stats</button>
            </div>

            <!-- Gross Performance Tab -->
            <div id="gross-tab" class="tab-content active">
                <div class="summary-cards">
                    <div class="summary-card">
                        <div class="value positive" id="gross-total-pnl">$0</div>
                        <div class="label">Total P&L (Gross)</div>
                    </div>
                    <div class="summary-card">
                        <div class="value positive" id="gross-win-rate">0%</div>
                        <div class="label">Win Rate</div>
                    </div>
                    <div class="summary-card">
                        <div class="value" id="gross-total-trades">0</div>
                        <div class="label">Total Trades</div>
                    </div>
                    <div class="summary-card">
                        <div class="value positive" id="gross-profit-factor">0</div>
                        <div class="label">Profit Factor</div>
                    </div>
                </div>

                <div class="stats-grid">
                    <div class="stats-card">
                        <h3>Profitability Metrics</h3>
                        <div class="stat-row">
                            <span class="stat-label">Average Trade P&L</span>
                            <span class="stat-value positive" id="gross-avg-trade">$0</span>
                        </div>
                        <div class="stat-row">
                            <span class="stat-label">Average P&L per Share</span>
                            <span class="stat-value positive" id="gross-avg-share">$0</span>
                        </div>
                        <div class="stat-row">
                            <span class="stat-label">Median Trade P&L</span>
                            <span class="stat-value positive" id="gross-median">$0</span>
                        </div>
                        <div class="stat-row">
                            <span class="stat-label">Largest Gain</span>
                            <span class="stat-value positive" id="gross-largest-gain">$0</span>
                        </div>
                        <div class="stat-row">
                            <span class="stat-label">Largest Loss</span>
                            <span class="stat-value negative" id="gross-largest-loss">$0</span>
                        </div>
                    </div>

                    <div class="stats-card">
                        <h3>Trade Distribution</h3>
                        <div class="stat-row">
                            <span class="stat-label">Winning Trades</span>
                            <span class="stat-value positive" id="gross-winning-trades">0</span>
                        </div>
                        <div class="stat-row">
                            <span class="stat-label">Losing Trades</span>
                            <span class="stat-value negative" id="gross-losing-trades">0</span>
                        </div>
                        <div class="stat-row">
                            <span class="stat-label">Scratch Trades</span>
                            <span class="stat-value neutral" id="gross-scratch-trades">0</span>
                        </div>
                        <div class="stat-row">
                            <span class="stat-label">Average Win</span>
                            <span class="stat-value positive" id="gross-avg-win">$0</span>
                        </div>
                        <div class="stat-row">
                            <span class="stat-label">Average Loss</span>
                            <span class="stat-value negative" id="gross-avg-loss">$0</span>
                        </div>
                    </div>

                    <div class="stats-card">
                        <h3>Risk Metrics</h3>
                        <div class="stat-row">
                            <span class="stat-label">Risk/Reward Ratio</span>
                            <span class="stat-value" id="gross-risk-reward">0</span>
                        </div>
                        <div class="stat-row">
                            <span class="stat-label">Sharpe Ratio</span>
                            <span class="stat-value positive" id="gross-sharpe">0</span>
                        </div>
                        <div class="stat-row">
                            <span class="stat-label">Max Drawdown</span>
                            <span class="stat-value negative" id="gross-drawdown">0%</span>
                        </div>
                        <div class="stat-row">
                            <span class="stat-label">Trade P&L Std Dev</span>
                            <span class="stat-value" id="gross-std">$0</span>
                        </div>
                        <div class="stat-row">
                            <span class="stat-label">SQN Score</span>
                            <span class="stat-value positive" id="gross-sqn">0</span>
                        </div>
                    </div>

                    <div class="stats-card">
                        <h3>Advanced Analytics</h3>
                        <div class="stat-row">
                            <span class="stat-label">K-Ratio</span>
                            <span class="stat-value positive" id="gross-k-ratio">0</span>
                        </div>
                        <div class="stat-row">
                            <span class="stat-label">Kelly %</span>
                            <span class="stat-value" id="gross-kelly">0%</span>
                        </div>
                        <div class="stat-row">
                            <span class="stat-label">P-Value</span>
                            <span class="stat-value" id="gross-p-value">0</span>
                        </div>
                        <div class="stat-row">
                            <span class="stat-label">Max Consecutive Wins</span>
                            <span class="stat-value positive" id="gross-max-wins">0</span>
                        </div>
                        <div class="stat-row">
                            <span class="stat-label">Max Consecutive Losses</span>
                            <span class="stat-value negative" id="gross-max-losses">0</span>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Net Performance Tab -->
            <div id="net-tab" class="tab-content">
                <div class="summary-cards">
                    <div class="summary-card">
                        <div class="value positive" id="net-total-pnl">$0</div>
                        <div class="label">Total P&L (Net)</div>
                    </div>
                    <div class="summary-card">
                        <div class="value positive" id="net-win-rate">0%</div>
                        <div class="label">Win Rate</div>
                    </div>
                    <div class="summary-card">
                        <div class="value" id="net-total-trades">0</div>
                        <div class="label">Total Trades</div>
                    </div>
                    <div class="summary-card">
                        <div class="value positive" id="net-profit-factor">0</div>
                        <div class="label">Profit Factor</div>
                    </div>
                </div>

                <div class="stats-grid">
                    <div class="stats-card">
                        <h3>Profitability Metrics (Net)</h3>
                        <div class="stat-row">
                            <span class="stat-label">Average Trade P&L</span>
                            <span class="stat-value positive" id="net-avg-trade">$0</span>
                        </div>
                        <div class="stat-row">
                            <span class="stat-label">Average P&L per Share</span>
                            <span class="stat-value positive" id="net-avg-share">$0</span>
                        </div>
                        <div class="stat-row">
                            <span class="stat-label">Median Trade P&L</span>
                            <span class="stat-value positive" id="net-median">$0</span>
                        </div>
                        <div class="stat-row">
                            <span class="stat-label">Largest Gain</span>
                            <span class="stat-value positive" id="net-largest-gain">$0</span>
                        </div>
                        <div class="stat-row">
                            <span class="stat-label">Largest Loss</span>
                            <span class="stat-value negative" id="net-largest-loss">$0</span>
                        </div>
                    </div>

                    <div class="stats-card">
                        <h3>Trade Distribution (Net)</h3>
                        <div class="stat-row">
                            <span class="stat-label">Winning P&L</span>
                            <span class="stat-value positive" id="net-winning-pnl">$0</span>
                        </div>
                        <div class="stat-row">
                            <span class="stat-label">Losing P&L</span>
                            <span class="stat-value negative" id="net-losing-pnl">$0</span>
                        </div>
                        <div class="stat-row">
                            <span class="stat-label">Average Win</span>
                            <span class="stat-value positive" id="net-avg-win">$0</span>
                        </div>
                        <div class="stat-row">
                            <span class="stat-label">Average Loss</span>
                            <span class="stat-value negative" id="net-avg-loss">$0</span>
                        </div>
                        <div class="stat-row">
                            <span class="stat-label">Total Wins</span>
                            <span class="stat-value positive" id="net-total-wins">0</span>
                        </div>
                    </div>

                    <div class="stats-card">
                        <h3>Risk Metrics (Net)</h3>
                        <div class="stat-row">
                            <span class="stat-label">Risk/Reward Ratio</span>
                            <span class="stat-value" id="net-risk-reward">0</span>
                        </div>
                        <div class="stat-row">
                            <span class="stat-label">Sharpe Ratio</span>
                            <span class="stat-value positive" id="net-sharpe">0</span>
                        </div>
                        <div class="stat-row">
                            <span class="stat-label">Max Drawdown</span>
                            <span class="stat-value negative" id="net-drawdown">0%</span>
                        </div>
                        <div class="stat-row">
                            <span class="stat-label">Trade P&L Std Dev</span>
                            <span class="stat-value" id="net-std">$0</span>
                        </div>
                        <div class="stat-row">
                            <span class="stat-label">SQN Score</span>
                            <span class="stat-value positive" id="net-sqn">0</span>
                        </div>
                    </div>

                    <div class="stats-card">
                        <h3>Advanced Analytics (Net)</h3>
                        <div class="stat-row">
                            <span class="stat-label">K-Ratio</span>
                            <span class="stat-value positive" id="net-k-ratio">0</span>
                        </div>
                        <div class="stat-row">
                            <span class="stat-label">Kelly %</span>
                            <span class="stat-value" id="net-kelly">0%</span>
                        </div>
                        <div class="stat-row">
                            <span class="stat-label">P-Value</span>
                            <span class="stat-value" id="net-p-value">0</span>
                        </div>
                        <div class="stat-row">
                            <span class="stat-label">Average Daily P&L</span>
                            <span class="stat-value positive" id="net-avg-daily">$0</span>
                        </div>
                        <div class="stat-row">
                            <span class="stat-label">Average Daily Volume</span>
                            <span class="stat-value" id="net-avg-volume">$0</span>
                        </div>
                    </div>
                </div>
            </div>

            <!-- General Stats Tab -->
            <div id="general-tab" class="tab-content">
                <div class="stats-grid">
                    <div class="stats-card">
                        <h3>Trading Costs</h3>
                        <div class="stat-row">
                            <span class="stat-label">Total Commissions</span>
                            <span class="stat-value negative" id="total-commissions">$0</span>
                        </div>
                        <div class="stat-row">
                            <span class="stat-label">Total Fees</span>
                            <span class="stat-value negative" id="total-fees">$0</span>
                        </div>
                        <div class="stat-row">
                            <span class="stat-label">Total Trading Costs</span>
                            <span class="stat-value negative" id="total-costs">$0</span>
                        </div>
                        <div class="stat-row">
                            <span class="stat-label">Cost per Trade</span>
                            <span class="stat-value" id="cost-per-trade">$0</span>
                        </div>
                        <div class="stat-row">
                            <span class="stat-label">Cost Impact</span>
                            <span class="stat-value negative" id="cost-impact">0%</span>
                        </div>
                    </div>

                    <div class="stats-card">
                        <h3>Hold Time Analysis</h3>
                        <div class="stat-row">
                            <span class="stat-label">Average Hold Time (Overall)</span>
                            <span class="stat-value" id="hold-overall">0m</span>
                        </div>
                        <div class="stat-row">
                            <span class="stat-label">Average Hold Time (Winners)</span>
                            <span class="stat-value positive" id="hold-winners">0m</span>
                        </div>
                        <div class="stat-row">
                            <span class="stat-label">Average Hold Time (Losers)</span>
                            <span class="stat-value negative" id="hold-losers">0m</span>
                        </div>
                        <div class="stat-row">
                            <span class="stat-label">Average Hold Time (Scratches)</span>
                            <span class="stat-value neutral" id="hold-scratches">0m</span>
                        </div>
                        <div class="stat-row">
                            <span class="stat-label">Hold Time Pattern</span>
                            <span class="stat-value positive" id="hold-pattern">0</span>
                        </div>
                    </div>

                    <div class="stats-card">
                        <h3>MFE/MAE Analysis</h3>
                        <div class="stat-row">
                            <span class="stat-label">Average MFE (Max Favorable)</span>
                            <span class="stat-value positive" id="avg-mfe">$0</span>
                        </div>
                        <div class="stat-row">
                            <span class="stat-label">Average MAE (Max Adverse)</span>
                            <span class="stat-value negative" id="avg-mae">$0</span>
                        </div>
                        <div class="stat-row">
                            <span class="stat-label">MFE/MAE Ratio</span>
                            <span class="stat-value positive" id="mfe-mae-ratio">0</span>
                        </div>
                        <div class="stat-row">
                            <span class="stat-label">Efficiency Score</span>
                            <span class="stat-value positive" id="efficiency">0%</span>
                        </div>
                        <div class="stat-row">
                            <span class="stat-label">Exit Quality</span>
                            <span class="stat-value positive" id="exit-quality">0</span>
                        </div>
                    </div>

                    <div class="stats-card">
                        <h3>Consecutive Streaks</h3>
                        <div class="stat-row">
                            <span class="stat-label">Max Consecutive Wins</span>
                            <span class="stat-value positive" id="max-wins">0</span>
                        </div>
                        <div class="stat-row">
                            <span class="stat-label">Max Consecutive Losses</span>
                            <span class="stat-value negative" id="max-losses">0</span>
                        </div>
                        <div class="stat-row">
                            <span class="stat-label">Current Streak</span>
                            <span class="stat-value positive" id="current-streak">0</span>
                        </div>
                        <div class="stat-row">
                            <span class="stat-label">Streak Consistency</span>
                            <span class="stat-value positive" id="streak-consistency">0</span>
                        </div>
                        <div class="stat-row">
                            <span class="stat-label">Recovery Rate</span>
                            <span class="stat-value positive" id="recovery-rate">0%</span>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <script>
            // Tab functionality
            function showTab (tabName) {
                // Hide all tabs
                const tabs = document.querySelectorAll('.tab-content');
                tabs.forEach(tab => tab.classList.remove('active'));

                // Remove active from all buttons
                const buttons = document.querySelectorAll('.tab-btn');
                buttons.forEach(btn => btn.classList.remove('active'));

                // Show selected tab
                document.getElementById(tabName + '-tab').classList.add('active');
                event.target.classList.add('active');
            }

            // Filter functions
            function applyFilters () {
                const filters = {
                    start: document.getElementById('start-date').value,
                    end: document.getElementById('end-date').value,
                    strategy: document.getElementById('strategy').value,
                    symbol: document.getElementById('symbol').value,
                    side: document.getElementById('side').value,
                    limit: document.getElementById('limit').value
                };

                // En una aplicación real, esto haría una petición al servidor
                console.log('Applying filters:', filters);

                // Simular actualización de datos
                updateStatsDisplay();
            }

            function resetFilters () {
                document.getElementById('start-date').value = '';
                document.getElementById('end-date').value = '';
                document.getElementById('strategy').value = '';
                document.getElementById('symbol').value = '';
                document.getElementById('side').value = '';
                document.getElementById('limit').value = '';

                updateStatsDisplay();
            }

            // Update display with sample data
            function updateStatsDisplay () {
                // Esta función se conectaría con los datos reales del backend
                console.log('Stats updated');
            }

            // Format currency values
            function formatCurrency (value) {
                return new Intl.NumberFormat('en-US', {
                    style: 'currency',
                    currency: 'USD',
                    minimumFractionDigits: 2
                }).format(value);
            }

            // Format percentage values
            function formatPercentage (value) {
                return new Intl.NumberFormat('en-US', {
                    style: 'percent',
                    minimumFractionDigits: 1,
                    maximumFractionDigits: 2
                }).format(value / 100);
            }

            // Simulate real data population
            function populateStatsFromBackend (stats) {
                // Gross Performance Tab
                document.getElementById('gross-total-pnl').textContent = formatCurrency(stats.gross.total_pnl);
                document.getElementById('gross-total-pnl').className = 'value ' + (stats.gross.total_pnl > 0 ? 'positive' : 'negative');

                document.getElementById('gross-win-rate').textContent = formatPercentage(stats.gross.win_rate);
                document.getElementById('gross-total-trades').textContent = stats.total_trades;
                document.getElementById('gross-profit-factor').textContent = stats.gross.profit_factor.toFixed(2);
                document.getElementById('gross-profit-factor').className = 'value ' + (stats.gross.profit_factor > 1 ? 'positive' : 'negative');

                document.getElementById('gross-avg-trade').textContent = formatCurrency(stats.gross.avg_trade_pnl);
                document.getElementById('gross-avg-share').textContent = stats.gross.avg_pnl_per_share.toFixed(4);
                document.getElementById('gross-median').textContent = formatCurrency(stats.gross.median_trade_pnl);
                document.getElementById('gross-largest-gain').textContent = formatCurrency(stats.gross.largest_gain);
                document.getElementById('gross-largest-loss').textContent = formatCurrency(stats.gross.largest_loss);

                document.getElementById('gross-winning-trades').textContent = stats.gross.winning_trades;
                document.getElementById('gross-losing-trades').textContent = stats.gross.losing_trades;
                document.getElementById('gross-scratch-trades').textContent = stats.gross.scratch_trades;
                document.getElementById('gross-avg-win').textContent = formatCurrency(stats.gross.avg_win);
                document.getElementById('gross-avg-loss').textContent = formatCurrency(stats.gross.avg_loss);

                document.getElementById('gross-risk-reward').textContent = stats.gross.risk_reward.toFixed(2);
                document.getElementById('gross-sharpe').textContent = stats.gross.sharpe_ratio.toFixed(2);
                document.getElementById('gross-drawdown').textContent = formatPercentage(stats.gross.max_drawdown);
                document.getElementById('gross-std').textContent = formatCurrency(stats.gross.trade_pnl_std);
                document.getElementById('gross-sqn').textContent = stats.gross.sqn.toFixed(2);

                document.getElementById('gross-k-ratio').textContent = stats.gross.k_ratio.toFixed(2);
                document.getElementById('gross-kelly').textContent = formatPercentage(stats.gross.kelly_percent);
                document.getElementById('gross-p-value').textContent = stats.gross.p_value.toFixed(4);
                document.getElementById('gross-max-wins').textContent = stats.gross.max_consecutive_wins;
                document.getElementById('gross-max-losses').textContent = stats.gross.max_consecutive_losses;

                // Net Performance Tab
                document.getElementById('net-total-pnl').textContent = formatCurrency(stats.net.total_pnl);
                document.getElementById('net-total-pnl').className = 'value ' + (stats.net.total_pnl > 0 ? 'positive' : 'negative');

                document.getElementById('net-win-rate').textContent = formatPercentage(stats.net.win_rate);
                document.getElementById('net-total-trades').textContent = stats.total_trades;
                document.getElementById('net-profit-factor').textContent = stats.net.profit_factor.toFixed(2);
                document.getElementById('net-profit-factor').className = 'value ' + (stats.net.profit_factor > 1 ? 'positive' : 'negative');

                document.getElementById('net-avg-trade').textContent = formatCurrency(stats.net.avg_trade_pnl);
                document.getElementById('net-avg-share').textContent = stats.net.avg_pnl_per_share.toFixed(4);
                document.getElementById('net-median').textContent = formatCurrency(stats.net.median_trade_pnl);
                document.getElementById('net-largest-gain').textContent = formatCurrency(stats.net.largest_gain);
                document.getElementById('net-largest-loss').textContent = formatCurrency(stats.net.largest_loss);

                document.getElementById('net-winning-pnl').textContent = formatCurrency(stats.net.winning_pnl);
                document.getElementById('net-losing-pnl').textContent = formatCurrency(stats.net.losing_pnl);
                document.getElementById('net-avg-win').textContent = formatCurrency(stats.net.avg_win);
                document.getElementById('net-avg-loss').textContent = formatCurrency(stats.net.avg_loss);
                document.getElementById('net-total-wins').textContent = stats.net.total_wins;

                document.getElementById('net-risk-reward').textContent = stats.net.risk_reward.toFixed(2);
                document.getElementById('net-sharpe').textContent = stats.net.sharpe_ratio.toFixed(2);
                document.getElementById('net-drawdown').textContent = formatPercentage(stats.net.max_drawdown);
                document.getElementById('net-std').textContent = formatCurrency(stats.net.trade_pnl_std);
                document.getElementById('net-sqn').textContent = stats.net.sqn.toFixed(2);

                document.getElementById('net-k-ratio').textContent = stats.net.k_ratio.toFixed(2);
                document.getElementById('net-kelly').textContent = formatPercentage(stats.net.kelly_percent);
                document.getElementById('net-p-value').textContent = stats.net.p_value.toFixed(4);
                document.getElementById('net-avg-daily').textContent = formatCurrency(stats.net.avg_daily_pnl);
                document.getElementById('net-avg-volume').textContent = formatCurrency(stats.net.avg_daily_volume);

                // General Stats Tab
                document.getElementById('total-commissions').textContent = formatCurrency(stats.total_commissions);
                document.getElementById('total-fees').textContent = formatCurrency(stats.total_fees);
                document.getElementById('total-costs').textContent = formatCurrency(stats.total_commissions + stats.total_fees);
                document.getElementById('cost-per-trade').textContent = formatCurrency((stats.total_commissions + stats.total_fees) / stats.total_trades);

                const costImpact = ((stats.gross.total_pnl - stats.net.total_pnl) / stats.gross.total_pnl) * 100;
                document.getElementById('cost-impact').textContent = formatPercentage(costImpact);

                document.getElementById('hold-overall').textContent = stats.avg_hold_time_overall;
                document.getElementById('hold-winners').textContent = stats.avg_hold_time_winners;
                document.getElementById('hold-losers').textContent = stats.avg_hold_time_losers;
                document.getElementById('hold-scratches').textContent = stats.avg_hold_time_scratches;

                document.getElementById('avg-mfe').textContent = formatCurrency(stats.avg_mfe);
                document.getElementById('avg-mae').textContent = formatCurrency(stats.avg_mae);

                const mfeMaeRatio = Math.abs(stats.avg_mfe / stats.avg_mae);
                document.getElementById('mfe-mae-ratio').textContent = mfeMaeRatio.toFixed(2);

                document.getElementById('max-wins').textContent = stats.net.max_consecutive_wins;
                document.getElementById('max-losses').textContent = stats.net.max_consecutive_losses;

                // Apply color classes based on values
                applyColorClasses();
            }

            function applyColorClasses () {
                // Apply positive/negative classes to values
                const elements = document.querySelectorAll('.stat-value');
                elements.forEach(el => {
                    const text = el.textContent;
                    if (text.includes('-') && !text.includes('ratio') && !text.includes('Ratio')) {
                        if (!el.classList.contains('negative')) {
                            el.classList.add('negative');
                        }
                    } else if (text.includes('%') || text.includes('$')) {
                        const numValue = parseFloat(text.replace(/[^0-9.-]/g, ''));
                        if (numValue > 0) {
                            if (!el.classList.contains('positive')) {
                                el.classList.add('positive');
                            }
                        } else if (numValue < 0) {
                            if (!el.classList.contains('negative')) {
                                el.classList.add('negative');
                            }
                        }
                    }
                });
            }

            // Sample data structure that matches the backend stats
            const sampleStats = JSON.parse('{{ stats|tojson|safe }}');
            const sampleStats_old = {
                // Shared stats
                total_trades: 247,
                total_commissions: 987.42,
                total_fees: 178.03,
                max_consecutive_wins: 12,
                max_consecutive_losses: 5,
                avg_hold_time_overall: "2h 15m",
                avg_hold_time_winners: "2h 45m",
                avg_hold_time_losers: "1h 28m",
                avg_hold_time_scratches: "45m",
                avg_mfe: 89.34,
                avg_mae: -42.17,

                // Gross stats
                gross: {
                    total_pnl: 12450.75,
                    winning_trades: 169,
                    losing_trades: 71,
                    scratch_trades: 7,
                    win_rate: 68.5,
                    loss_rate: 28.7,
                    winning_pnl: 22821.20,
                    losing_pnl: -10370.45,
                    avg_trade_pnl: 50.41,
                    avg_pnl_per_share: 0.1250,
                    median_trade_pnl: 32.15,
                    avg_win: 127.85,
                    avg_loss: -89.42,
                    largest_gain: 845.20,
                    largest_loss: -423.50,
                    risk_reward: 1.43,
                    total_wins: 169,
                    total_losses: 71,
                    profit_factor: 1.85,
                    trade_pnl_std: 156.32,
                    sharpe_ratio: 1.24,
                    max_drawdown: -8.5,
                    sqn: 2.15,
                    k_ratio: 0.83,
                    kelly_percent: 12.5,
                    p_value: 0.0234,
                    avg_daily_pnl: 195.12,
                    avg_daily_volume: 13250.00
                },

                // Net stats
                net: {
                    total_pnl: 11285.30,
                    winning_trades: 169,
                    losing_trades: 71,
                    scratch_trades: 7,
                    win_rate: 68.5,
                    loss_rate: 28.7,
                    winning_pnl: 21635.75,
                    losing_pnl: -10350.45,
                    avg_trade_pnl: 45.69,
                    avg_pnl_per_share: 0.1135,
                    median_trade_pnl: 27.83,
                    avg_win: 123.13,
                    avg_loss: -94.14,
                    largest_gain: 840.48,
                    largest_loss: -428.22,
                    risk_reward: 1.31,
                    total_wins: 169,
                    total_losses: 71,
                    profit_factor: 1.72,
                    trade_pnl_std: 161.47,
                    sharpe_ratio: 1.18,
                    max_drawdown: -9.2,
                    sqn: 2.01,
                    k_ratio: 0.79,
                    kelly_percent: 11.8,
                    p_value: 0.0298,
                    avg_daily_pnl: 185.42,
                    avg_daily_volume: 12350.00
                }
            };

            // Initialize the page
            document.addEventListener('DOMContentLoaded', function () {
                // Set default date range (last 30 days)
                const endDate = new Date();
                const startDate = new Date();
                startDate.setDate(startDate.getDate() - 30);

                document.getElementById('start-date').value = startDate.toISOString().split('T')[0];
                document.getElementById('end-date').value = endDate.toISOString().split('T')[0];

                // Load initial data with sample stats
                populateStatsFromBackend(sampleStats);

                // Add keyboard shortcuts
                document.addEventListener('keydown', function (e) {
                    if (e.key === 'Enter' && (e.ctrlKey || e.metaKey)) {
                        applyFilters();
                    }
                });
            });

            // Enhanced update function that would connect to real backend
            function updateStatsDisplay () {
                // In a real application, this would make an AJAX call to your Flask route
                // fetch('/performance?' + new URLSearchParams(filters))
                //     .then(response => response.json())
                //     .then(data => populateStatsFromBackend(data.stats));

                // For now, simulate loading with sample data
                setTimeout(() => {
                    populateStatsFromBackend(sampleStats);
                }, 300);
            }

            // Add loading state functionality
            function showLoading () {
                // Add loading indicators if needed
                document.body.style.cursor = 'wait';
            }

            function hideLoading () {
                document.body.style.cursor = 'default';
            }
        </script>
    </body>

</html>